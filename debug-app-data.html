<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>应用数据调试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .debug-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success {
            color: #155724;
            background: #d4edda;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        pre {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>应用数据加载调试</h1>
    
    <div class="debug-section">
        <div class="debug-title">检查结果</div>
        <div id="output"></div>
        <button class="test-button" onclick="runTests()">运行测试</button>
    </div>

    <!-- 引入依赖文件 -->
    <script src="app-search-database.js"></script>
    <script src="app-search-list.js"></script>

    <script>
        function runTests() {
            const output = document.getElementById('output');
            let html = '';

            try {
                // 1. 检查 AppSearchDB
                if (typeof window.AppSearchDB !== 'undefined') {
                    html += '<div class="success">✓ AppSearchDB 已加载</div>';
                    
                    const allApps = window.AppSearchDB.getAllApps();
                    html += '<div class="success">✓ 获取到 ' + allApps.length + ' 个应用</div>';
                    
                    const letters = window.AppSearchDB.getAllLetters();
                    html += '<div class="success">✓ 字母索引: ' + letters.join(', ') + '</div>';
                    
                    if (allApps.length > 0) {
                        html += '<div><strong>前3个应用:</strong></div>';
                        for (let i = 0; i < Math.min(3, allApps.length); i++) {
                            const app = allApps[i];
                            html += '<pre>' + JSON.stringify(app, null, 2) + '</pre>';
                        }
                    }
                } else {
                    html += '<div class="error">✗ AppSearchDB 未加载</div>';
                }

                // 2. 检查 AppSearchList
                if (typeof window.AppSearchList !== 'undefined') {
                    html += '<div class="success">✓ AppSearchList 已加载</div>';
                } else {
                    html += '<div class="error">✗ AppSearchList 未加载</div>';
                }

                // 3. 测试模态框创建
                if (window.AppSearchList) {
                    try {
                        window.AppSearchList.createSearchListModal();
                        const modal = document.getElementById('appSearchModal');
                        if (modal) {
                            html += '<div class="success">✓ 模态框创建成功</div>';
                            
                            // 测试数据加载
                            window.AppSearchList.loadApps();
                            
                            const appItems = modal.querySelectorAll('.app-list-item');
                            const letterItems = modal.querySelectorAll('.letter-index-item');
                            
                            html += '<div>字母索引项: ' + letterItems.length + '</div>';
                            html += '<div>应用项: ' + appItems.length + '</div>';
                            
                            if (appItems.length > 0) {
                                html += '<div class="success">✓ 应用数据渲染成功</div>';
                            } else {
                                html += '<div class="error">✗ 应用数据渲染失败</div>';
                                
                                // 检查具体错误
                                const appListScroll = document.getElementById('appListScroll');
                                if (appListScroll) {
                                    html += '<div>appListScroll 内容长度: ' + appListScroll.innerHTML.length + '</div>';
                                    if (appListScroll.innerHTML.length > 0) {
                                        html += '<pre>' + appListScroll.innerHTML.substring(0, 500) + '...</pre>';
                                    }
                                }
                            }
                        } else {
                            html += '<div class="error">✗ 模态框创建失败</div>';
                        }
                    } catch (error) {
                        html += '<div class="error">模态框测试错误: ' + error.message + '</div>';
                    }
                }

            } catch (error) {
                html += '<div class="error">测试错误: ' + error.message + '</div>';
                console.error('测试错误:', error);
            }

            output.innerHTML = html;
        }

        // 页面加载时自动运行测试
        window.addEventListener('load', function() {
            setTimeout(runTests, 100);
        });
    </script>
</body>
</html>